<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <title>AA's Online Judge</title>

    <style>
      body {
        font-family: Verdana;
      }

      .container {
        margin-top: 14px;
        margin-bottom: 50px;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 50px;
      }

      .header h1 {
        flex-grow: 1;
        text-align: center;
      }

      .header button {
        margin-left: auto;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .alert {
        margin-bottom: 20px;
      }

      .text-center {
        text-align: center;
      }

      #editor {
        border: 1px solid #ced4da;
        height: 400px;
        background-color: white;
      }

      .form-control {
        border: 1px solid #ced4da;
        font-size: 15px;
      }

      /* Dark mode styles */
      body.dark-mode {
        background-color: #121212;
        color: #e0e0e0;
      }

      .dark-mode #editor {
        background-color: #1e1e1e;
        color: #e0e0e0;
      }

      .dark-mode .form-control {
        background-color: #1e1e1e;
        color: #e0e0e0;
        border-color: #333;
      }

      .dark-mode .btn {
        background-color: #333;
        color: #e0e0e0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Algo Arena's Online Judge</h1>
        <button id="toggleTheme" class="btn btn-secondary rounded-circle" style="transition: background-color 0.3s, transform 0.3s;">
          <i id="themeIcon" class="fas fa-moon"></i>
        </button>
      </div>

      <form id="codeForm" action="/runcode" method="post" onsubmit="return validateForm()">
        {% csrf_token %}

        <!-- Display success or error messages -->
        <div id="error-message" class="alert alert-danger text-center" style="display: none;">Error: No code written.</div>

        {% if success_message %}
          <div class="alert alert-success text-center">{{ success_message }}</div>
        {% elif code %}
          <div class="alert alert-danger text-center">Status: Wrong Answer</div>
        {% else %}
          <div class="alert alert-info text-center">Enter your code and input to run</div>
        {% endif %}

        <div class="row">
          <!-- Left Column: Code Editor -->
          <div class="col-md-8">
            <div class="form-group">
              <label for="editor">Enter your code here:</label>
              <div id="editor"></div>
              <textarea id="codearea" name="codearea" style="display:none;">{{ code }}</textarea>
            </div>
          </div>

          <!-- Right Column: Input and Output -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="input">Enter Input:</label>
              <textarea class="form-control" id="input" name="input" rows="3"></textarea>
            </div>

            <div class="form-group">
              <label for="output">Output</label>
              <textarea class="form-control" id="output" name="output" rows="4" disabled>{{ output }}</textarea>
            </div>
          </div>
        </div>

        <!-- Display execution time and memory usage -->
        <p class="text-center">Execution Time: {{ execution_time }} seconds &nbsp;&nbsp;&nbsp; <br> Memory Usage: {{ memory_usage_mb }} MB</p>
        <div class="text-center">
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.30.1/min/vs/loader.min.js"></script>
    <script>
      function validateForm() {
        var codearea = document.getElementById('codearea').value.trim();
        var errorMessage = document.getElementById('error-message');

        if (codearea === "") {
          errorMessage.style.display = 'block';
          return false;
        } else {
          errorMessage.style.display = 'none';
          return true;
        }
      }

      require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.30.1/min/vs' }});
      require(['vs/editor/editor.main'], function() {
        var editor = monaco.editor.create(document.getElementById('editor'), {
          value: document.getElementById('codearea').value,
          language: 'python',
          theme: 'vs-light',
          fontSize: 15, // Set font size for Monaco Editor
          automaticLayout: true
        });

        // Update hidden textarea with editor content on form submit
        var codeForm = document.getElementById('codeForm');
        codeForm.onsubmit = function() {
          document.getElementById('codearea').value = editor.getValue();
        };

        // Load theme from localStorage
        if (localStorage.getItem('theme') === 'dark') {
          document.body.classList.add('dark-mode');
          editor.updateOptions({ theme: 'vs-dark' });
          document.getElementById('themeIcon').classList.replace('fa-sun', 'fa-moon');
        }

        // Toggle dark mode
        document.getElementById('toggleTheme').onclick = function() {
          document.body.classList.toggle('dark-mode');
          var isDarkMode = document.body.classList.contains('dark-mode');
          editor.updateOptions({ theme: isDarkMode ? 'vs-dark' : 'vs-light' });
          localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
          document.getElementById('themeIcon').classList.toggle('fa-sun');
          document.getElementById('themeIcon').classList.toggle('fa-moon');
        };
      });
    </script>
  </body>
</html>